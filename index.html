<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disparador de Contatos WhatsApp</title>
    
    <!-- Scripts e Fontes Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS (style.css) -->
    <link rel="stylesheet" href="style.css">

</head>
<body class="bg-gray-50 min-h-screen">
    
    <!-- Header -->
    <header class="main-header">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <i class="fab fa-whatsapp text-green-500 text-3xl mr-3"></i>
                    <h1 class="text-xl header-title">Disparador de Contatos</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="helpBtn" title="Ajuda" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-question-circle text-xl"></i>
                    </button>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-gray-500">Qual o seu objetivo?</span>
                        <select id="modeToggle" class="form-select text-sm px-2 py-1">
                            <option value="vcf">Modo 1: Baixar Contatos (para Celular)</option>
                            <option value="api">Modo 2: Envio Automático (Avançado)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- GUIA PASSO A PASSO -->
        <div class="content-card mb-8">
            <h2 class="text-lg font-semibold text-gray-900 mb-6 text-center">Comece por aqui - Guia Rápido</h2>
            <div class="step-guide-container">

                <!-- Passo 1 -->
                <div class="step-card">
                    <div class="step-icon primary">
                        <!-- Ícone atualizado -->
                        <i class="fas fa-file-arrow-up"></i>
                    </div>
                    <div class="step-text">
                        <h3>Passo 1: Envie</h3>
                        <!-- Texto atualizado -->
                        <p>Envie sua planilha (Excel, CSV) ou um PDF com tabelas.</p>
                    </div>
                </div>

                <!-- Passo 2 -->
                <div class="step-card">
                    <div class="step-icon primary">
                        <i class="fas fa-list-check"></i>
                    </div>
                    <div class="step-text">
                        <h3>Passo 2: Verifique</h3>
                        <p>Confirme se a IA acertou as colunas de Nome e Telefone.</p>
                    </div>
                </div>

                <!-- Passo 3 -->
                <div class="step-card">
                    <div class="step-icon primary">
                        <i class="fas fa-pen-to-square"></i>
                    </div>
                    <div class="step-text">
                        <h3>Passo 3: Escreva</h3>
                        <p>Crie sua mensagem. Use {name} para personalizar.</p>
                    </div>
                </div>

                <!-- Passo 4 -->
                <div class="step-card">
                    <div class="step-icon secondary">
                        <i class="fas fa-paper-plane"></i>
                    </div>
                    <div class="step-text">
                        <h3>Passo 4: Ação Final</h3>
                        <p>Escolha como salvar ou enviar seus contatos.</p>
                    </div>
                </div>
            </div>

            <!-- Bloco de Ajuda da IA (ATUALIZADO) -->
            <div class="mt-6 pt-5 border-t border-gray-200 text-center">
                <i class="fas fa-robot text-primary-color text-2xl mb-2"></i>
                <h4 class="font-semibold text-gray-800">Precisa de Ajuda?</h4>
                <p class="text-sm text-neutral-text">
                    <!-- ATUALIZAÇÃO: Texto adicionado conforme solicitado -->
                    Se tiver qualquer dúvida, clique no <span class="font-bold text-primary-color">robozinho roxo</span>
                    no canto da tela. Ele te auxiliará em tudo!
                </p>
            </div>
            <!-- FIM DO BLOCO -->

        </div>

        <!-- Upload Section -->
        <div class="content-card">
            <h2 class="card-title">Passo 1: Envie seu Arquivo</h2>
            
            <!-- ATUALIZAÇÃO: Zona de Upload com novos textos e ícone -->
            <div id="dropZone">
                <i class="fas fa-file-arrow-up"></i>
                <p class="text-lg font-medium text-gray-700 mb-2">Arraste seu arquivo (PDF, Excel, CSV) aqui</p>
                <p class="text-sm text-gray-500 mb-4">ou clique para procurar no computador</p>
                <button id="browseBtn" class="btn btn-primary">
                    <i class="fas fa-folder-open mr-2"></i>Escolher Arquivo
                </button>
                <!-- ATUALIZAÇÃO: Aceita .pdf -->
                <input type="file" id="fileInput" accept=".xlsx,.xls,.csv,.pdf" class="hidden">
            </div>

            <!-- File Info -->
            <div id="fileInfo" class="mt-4 hidden">
                <!-- ATUALIZAÇÃO: Adicionado botão de Download de Excel -->
                <div class="flex items-center justify-between bg-gray-50 rounded-lg p-4 border border-gray-200">
                    <div class="flex items-center">
                        <!-- ATUALIZAÇÃO: Ícone genérico que será alterado pelo JS -->
                        <i id="fileIcon" class="fas fa-file-lines text-gray-600 text-2xl mr-4"></i>
                        <div>
                            <p id="fileName" class="font-medium text-gray-900"></p>
                            <p id="fileSize" class="text-sm text-gray-500"></p>
                        </div>
                    </div>
                    <!-- NOVO: Wrapper para botões -->
                    <div class="flex items-center space-x-3">
                        <button id="downloadConvertedExcelBtn" 
                                class="btn btn-secondary text-xs py-1 px-3 hidden" 
                                title="Baixar o arquivo Excel convertido do PDF">
                            <i class="fas fa-file-excel mr-1"></i>Baixar Excel
                        </button>
                        <button id="removeFile" class="btn-danger-icon" title="Remover arquivo">
                            <i class="fas fa-times-circle"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Column Mapping Section -->
        <div id="mappingSection" class="content-card hidden">
            <h2 class="card-title">Passo 2: Verifique as Colunas</h2>
            <p class="text-sm text-gray-500 -mt-6 mb-4">A IA tentou adivinhar. Por favor, confirme se está correto.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Coluna do Aluno (Nome Principal) -->
                <div>
                    <label class="form-label font-bold text-gray-800" for="alunoColumn">Qual coluna tem o NOME DO ALUNO? (Principal)</label>
                    <select id="alunoColumn" class="form-select">
                        <option value="">Selecione a coluna...</option>
                    </select>
                </div>
                <!-- Coluna do Telefone -->
                <div>
                    <label class="form-label font-bold text-gray-800" for="phoneColumn">Qual coluna tem o NÚMERO DE TELEFONE?</label>
                    <select id="phoneColumn" class="form-select">
                        <option value="">Selecione a coluna...</option>
                    </select>
                </div>
            </div>
            
            <!-- Campos Opcionais -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6 border-t border-gray-200 pt-6">
                <div>
                    <!-- ATUALIZAÇÃO: Nome da coluna do responsável -->
                    <label class="form-label" for="responsavelColumn">Qual coluna tem o nome do RESPONSÁVEL? (Opcional)</label>
                    <select id="responsavelColumn" class="form-select">
                        <option value="">Selecione a coluna...</option>
                    </select>
                </div>
                <div>
                    <label class="form-label" for="turmaColumn">Qual coluna tem a TURMA? (Opcional)</label>
                    <select id="turmaColumn" class="form-select">
                        <option value="">Selecione a coluna...</option>
                    </select>
                </div>
            </div>

            <!-- AI Detection Status -->
            <div id="aiStatus" class="mt-6 hidden">
                <div class="flex items-center p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <i class="fas fa-robot text-blue-600 mr-3"></i>
                    <span class="text-sm text-blue-800">AI detectou e mapeou colunas automaticamente.</span>
                </div>
            </div>
        </div>

        <!-- Contact Preview Section -->
        <div id="previewSection" class="content-card hidden">
            <div class="flex justify-between items-center -mt-2 mb-4">
                <h2 class="card-title mb-0 border-none p-0">Prévia da Validação</h2>
                <div class="flex items-center space-x-4 text-sm">
                    <span class="status-valid"><i class="fas fa-check-circle mr-1"></i>Válido</span>
                    <span class="status-invalid"><i class="fas fa-times-circle mr-1"></i>Inválido</span>
                </div>
            </div>
            
            <div class="mb-4 bg-gray-50 p-3 rounded-lg border">
                <p class="text-sm text-gray-600">Mostrando os primeiros 200 de <span id="totalContacts" class="font-bold">0</span> contatos. Contatos <span class="font-bold status-invalid">inválidos</span> são movidos para o final da lista.</p>
            </div>

            <div class="table-container">
                <table class="w-full text-sm">
                    <thead class="table-header">
                        <tr>
                            <th>#</th>
                            <th>Aluno (Nome)</th>
                            <th>Responsável</th>
                            <th>Turma</th>
                            <th>Telefone (Original/Formatado)</th>
                            <th>DDD</th>
                            <th>Status</th>
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody id="contactTable" class="divide-y divide-gray-200">
                        <!-- Linhas da tabela serão populadas pelo JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Message Composer Section -->
        <div id="messageSection" class="content-card hidden">
            <h2 class="card-title">Passo 3: Escreva sua Mensagem</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="form-label" for="messageTemplate">Sua mensagem:</label>
                    <!--
                        COMENTÁRIO DE SEGURANÇA (Anti-Hacking: XSS):
                        A entrada do usuário aqui (template) é segura.
                        O `main.js` NUNCA a insere como HTML puro. Ele a usa para
                        gerar a PRÉVIA, mas higieniza a prévia usando
                        `.textContent` (veja `updateMessagePreview` no main.js),
                        o que previne ataques de Cross-Site Scripting (XSS).
                    -->
                    <textarea id="messageTemplate" rows="5" class="form-textarea" placeholder="Olá {name}, esta é uma mensagem da nossa escola..."></textarea>
                    <div class="flex justify-between items-center mt-2">
                        <div class="text-xs text-gray-500">
                            Use <span class="placeholder-highlight">{name}</span> para o nome do aluno.
                        </div>
                        <div class="text-xs text-gray-500">
                            <span id="charCount">0</span>/4096 caracteres
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 border">
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Prévia (como o primeiro contato verá):</h3>
                    <div id="messagePreview" class="text-sm text-gray-800 bg-white p-3 rounded border border-gray-300 min-h-[50px]">
                        <!-- A prévia é inserida aqui usando .textContent, o que a torna 100% segura contra XSS. -->
                    </div>
                </div>
            </div>
        </div>

        <!-- API Configuration Section (ATUALIZADO COM GUIA PARA LEIGOS) -->
        <div id="apiConfigSection" class="content-card hidden">
            <h2 class="card-title">Passo 3.5: Configurar Envio Automático (Modo API)</h2>
            <p class="text-sm text-gray-500 -mt-6 mb-4">Este passo é técnico. Preencha isto *apenas* se você escolheu o "Modo 2: Envio Automático".</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="form-label" for="accessToken">Token de Acesso da API</label>
                    <input type="password" id="accessToken" class="form-input" placeholder="EAAxxxxxxxx... (segredo)">
                </div>
                <div>
                    <label class="form-label" for="phoneNumberId">ID do Número de Telefone</label>
                    <input type="text" id="phoneNumberId" class="form-input" placeholder="123456789012345">
                </div>
                <div>
                    <label class="form-label" for="templateName">Nome do Template (Opcional)</label>
                    <input type="text" id="templateName" class="form-input" placeholder="ex: hello_world">
                </div>
                <div>
                    <label class="form-label" for="languageCode">Código do Idioma (do template)</label>
                    <select id="languageCode" class="form-select">
                        <option value="pt_BR">Português (Brasil)</option>
                        <option value="en">Inglês</option>
                        <option value="es">Espanhol</option>
                        <option value="fr">Francês</option>
                    </select>
                </div>
            </div>

            <!--
            ================================================================================
            | NOVO: GUIA PARA LEIGOS (Conforme solicitado)
            ================================================================================
            -->
            <div class="mt-8 pt-6 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 mb-3">Guia Rápido (para Leigos): Onde encontrar estas informações?</h3>
                <p class="text-sm text-gray-600 mb-4">
                    Todas essas chaves são encontradas dentro da sua conta de <a href="https://developers.facebook.com/" target="_blank" class="text-blue-600 hover:underline">Desenvolvedor da Meta (Facebook)</a>, após você configurar um Aplicativo e a API do WhatsApp.
                </p>

                <div class="space-y-4">
                    <!-- Passo 1: ID do Número -->
                    <div class="flex items-start">
                        <span class="flex-shrink-0 w-8 h-8 bg-primary-color text-white rounded-full flex items-center justify-center font-bold text-sm mr-4">1</span>
                        <div>
                            <h4 class="font-semibold text-gray-800">ID do Número de Telefone</h4>
                            <p class="text-sm text-gray-600">
                                No seu aplicativo da Meta, vá para <strong class="text-gray-900">"WhatsApp" > "Configuração da API"</strong>.
                                O <strong class="text-gray-900">"ID do número de telefone"</strong> estará visível logo no topo, na seção "1. Enviar mensagens com a API".
                            </p>
                        </div>
                    </div>

                    <!-- Passo 2: Token de Acesso -->
                    <div class="flex items-start">
                        <span class="flex-shrink-0 w-8 h-8 bg-primary-color text-white rounded-full flex items-center justify-center font-bold text-sm mr-4">2</span>
                        <div>
                            <h4 class="font-semibold text-gray-800">Token de Acesso da API</h4>
                            <p class="text-sm text-gray-600">
                                Na <strong class="text-gray-900">mesma página</strong> ("Configuração da API"), role para baixo até a seção <strong class="text-gray-900">"2. Enviar mensagens com a API"</strong>.
                                Você verá um campo chamado <strong class="text-gray-900">"Token de acesso temporário"</strong>. Clique em "Copiar" e cole aqui.
                            </p>
                            <p class="text-xs text-red-600 mt-1">
                                <i class="fas fa-exclamation-triangle mr-1"></i><strong>Atenção:</strong> Este token expira a cada 23 horas. Para um envio profissional, você deve gerar um "Token de Acesso Permanente" (uma configuração mais avançada na Meta).
                            </p>
                        </div>
                    </div>

                    <!-- Passo 3: Nome do Template -->
                    <div class="flex items-start">
                        <span class="flex-shrink-0 w-8 h-8 bg-gray-600 text-white rounded-full flex items-center justify-center font-bold text-sm mr-4">3</span>
                        <div>
                            <h4 class="font-semibold text-gray-800">Nome do Template (Opcional)</h4>
                            <p class="text-sm text-gray-600">
                                <strong>Opção A (Recomendada):</strong> Deixe este campo <strong class="text-gray-900">vazio</strong>. O sistema enviará a mensagem que você escreveu no "Passo 3" (acima).
                            </p>
                            <p class="text-sm text-gray-600 mt-1">
                                <strong>Opção B (Avançada):</strong> Se você criou um "Modelo de Mensagem" pré-aprovado pela Meta (na seção "2. Criar modelos de mensagem"), você pode colocar o <strong class="text-gray-900">nome exato</strong> dele aqui (ex: `aviso_de_reuniao`).
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- FIM DO GUIA PARA LEIGOS -->

            <div class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                <div class="flex items-start">
                    <i class="fas fa-exclamation-triangle text-yellow-600 mt-0.5 mr-3"></i>
                    <div class="text-sm text-yellow-800">
                        <p class="font-medium">Aviso de Segurança (LGPD: Retenção de Dados)</p>
                        <p>Suas credenciais de API são armazenadas apenas temporariamente no seu navegador e nunca são enviadas ao nosso servidor.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div id="finalStepSection" class="content-card hidden">
            <h2 class="card-title">Passo 4: Escolha sua Ação Final</h2>
            
            <!-- Modo 1: VCF (Baixar Contatos) -->
            <div id="vcfModeExplanation" class="mode-explanation">
                <div class="flex items-center mb-2">
                    <i class="fas fa-address-book text-secondary-color text-2xl mr-3"></i>
                    <h3>Modo 1: Baixar Contatos (para Celular)</h3>
                </div>
                <p>
                    Isso cria um arquivo mágico de "Contatos" (chamado VCF). Você envia esse arquivo para o seu celular, abre ele, e <strong>todos os contatos válidos são salvos na sua agenda de uma só vez!</strong> (100% offline e privado).
                </p>
                <button id="generateVcfBtn" class="btn btn-secondary text-base px-8 py-3">
                    <i class="fas fa-download mr-2"></i>Baixar Arquivo de Contatos
                </button>
            </div>

            <!-- Modo 2: API (Envio Automático) -->
            <div id="apiModeExplanation" class="mode-explanation" style="display: none;">
                <div class="flex items-center mb-2">
                     <i class="fas fa-robot text-primary-color text-2xl mr-3"></i>
                    <h3>Modo 2: Envio Automático (Avançado)</h3>
                </div>
                <p>
                    Isso usa uma ferramenta profissional (API) para <strong>enviar sua mensagem automaticamente</strong> para cada contato válido, um por um, direto no WhatsApp. Você não precisa fazer mais nada. (Requer a configuração técnica no Passo 3.5).
                </p>
                <button id="sendMessagesBtn" class="btn btn-primary text-base px-8 py-3">
                    <i class="fas fa-paper-plane mr-2"></i>Enviar Mensagens Automáticas
                </button>
            </div>
        </div>
    </main>

    <!-- Chatbot Floating Button (Z-index ATUALIZADO) -->
    <button id="chatToggleBtn" class="fixed bottom-6 right-6 p-4 rounded-full shadow-lg transition-all z-[1001]" title="Ajuda da IA">
        <i class="fas fa-robot text-xl"></i>
    </button>

    <!-- Chatbot Container (ATUALIZADO: Classes responsivas para Mobile) -->
    <div id="chatContainer" 
         class="chat-container fixed z-[1000] 
                w-full max-w-xs right-4 bottom-4
                sm:max-w-sm sm:right-6 sm:bottom-[5.5rem]
                transition-all duration-300 ease-in-out 
                opacity-0 scale-95 -translate-y-4 pointer-events-none">
        
        <div class="chat-window rounded-lg">
            <!-- Chat Header -->
            <div class="chat-header flex justify-between items-center">
                <h3 class="font-semibold text-sm">Ajudante Geral a AI</h3>
                <button id="chatCloseBtn" class="text-white hover:text-gray-200 p-1">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <!-- Messages (ATUALIZADO: Altura fixa e scroll) -->
            <div id="chatMessages" class="chat-messages flex flex-col space-y-2 h-[400px] overflow-y-auto">
                <!-- 
                    COMENTÁRIO DE SEGURANÇA (Anti-Hacking: XSS):
                    As mensagens são inseridas aqui via main.js, função addMessage(), 
                    que usa escapeHtml() para higienizar o texto antes de inseri-lo,
                    prevenindo ataques XSS.
                -->
            </div>
            <!-- Input -->
            <div class="p-3 border-t border-gray-200 bg-white">
                <div id="chatStatus" class="text-xs text-gray-500 mb-1 hidden">
                    <i class="fas fa-spinner fa-spin mr-1"></i> A AI está digitando...
                </div>
                <form id="chatForm" class="flex">
                    <input type="text" id="chatInput" class="form-input rounded-r-none" placeholder="Pergunte sobre seus contatos...">
                    <button type="submit" id="chatSendBtn" class="btn btn-primary rounded-l-none">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Progress Modal (Z-index ATUALIZADO) -->
    <div id="progressModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-[1002] p-4">
        <div class="modal-content w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 id="progressTitle" class="text-lg font-semibold text-gray-900">Processando Contatos</h3>
                <button id="closeProgress" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div class="flex justify-between text-sm font-medium">
                    <span id="progressText">Processando...</span>
                    <span id="progressCount">0/0</span>
                </div>
                
                <div class="w-full progress-bar-bg rounded-full h-2.5">
                    <div id="progressBar" class="progress-bar h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                
                <div id="progressDetails" class="text-sm text-gray-600 space-y-1 max-h-32 overflow-y-auto">
                    <!-- Progress details will be shown here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal (ATUALIZADO: Z-index e estrutura do confirmText) -->
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-[1003] p-4">
        <div class="modal-content w-full max-w-md">
            <h3 id="confirmTitle" class="text-lg font-semibold text-gray-900 mb-4">Confirmar Remoção</h3>
            <!-- ATUALIZAÇÃO: A mensagem (e a lista de detalhes) será inserida aqui -->
            <div id="confirmText" class="text-sm text-gray-600 mb-6 space-y-3">
                <!-- Ex: "A IA preparou..." -->
                <!-- Ex: <ul class="list-disc...">...</ul> -->
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="confirmCancelBtn" class="btn bg-gray-200 text-gray-800 hover:bg-gray-300">
                    Cancelar
                </button>
                <button id="confirmActionBtn" class="btn btn-primary bg-red-600 hover:bg-red-700">
                    Remover
                </button>
            </div>
        </div>
    </div>
    
    <!-- NOVO: Modal de Confirmação de Envio para IA -->
    <div id="aiConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-[1003] p-4">
        <div class="modal-content w-full max-w-md">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Confirmar Análise (LGPD)</h3>
            
            <div id="aiConfirmText" class="text-sm text-gray-600 mb-6 space-y-3">
                <!-- Conteúdo inserido via JS -->
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="aiConfirmCancelBtn" class="btn bg-gray-200 text-gray-800 hover:bg-gray-300">
                    Cancelar
                </button>
                <button id="aiConfirmSendBtn" class="btn btn-primary">
                    <i class="fas fa-paper-plane mr-2"></i>Continuar
                </button>
            </div>
        </div>
    </div>


    <!-- Help Modal (ATUALIZADO: Z-index e max-width) -->
    <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-[1002] p-4">
        <div class="modal-content w-full max-w-3xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Ajuda, Segurança e Conformidade (LGPD)</h3>
                <button id="closeHelp" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <!-- Seção de Instruções -->
                <div>
                    <h4 class="font-medium text-gray-900 mb-2">Como Usar (O Básico)</h4>
                    <!-- ATUALIZAÇÃO: Instruções incluem PDF -->
                    <ol class="list-decimal list-inside space-y-2 text-sm text-gray-600">
                        <li><strong>Passo 1:</strong> Carregue um arquivo Excel (.xlsx, .xls), CSV ou PDF (que contenha tabelas).</li>
                        <li><strong>(Se PDF):</strong> Aguarde a conversão automática para Excel. Você pode baixar este Excel usando o novo botão verde.</li>
                        <li><strong>Passo 2:</strong> O site tentará adivinhar as colunas. Confira se "Nome do Aluno" e "Telefone" estão corretos.</li>
                        <li><strong>Ajuda da IA:</strong> A qualquer momento, clique no <strong>robô roxo</strong> para tirar dúvidas sobre seus dados ou sobre o site.</li>
                        <li><strong>Remover Contato:</strong> Você pode clicar no ícone de lixeira (<i class="fas fa-trash-alt"></i>) na tabela para remover um contato, ou pedir à IA (ex: "Remover contato João da Silva", "Remover todos os inválidos").</li>
                        <li><strong>Passo 3:</strong> Escreva a mensagem. Use `{name}` para o nome do aluno.</li>
                        <li><strong>Passo 4 (Escolha o Modo):</strong> No topo da página, escolha seu objetivo (Modo 1 ou Modo 2).</li>
                    </ol>
                </div>
                
                <!-- 
                ================================================================================
                | SEÇÃO DE SEGURANÇA (LGPD E ANTI-HACKING) - ATUALIZADA (8 Nov 2025)
                ================================================================================
                -->
                <div>
                    <h4 class="font-medium text-gray-900 mb-2">Nossa Política de Segurança e LGPD (Atualizado em 8 de Novembro de 2025)</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        Este site leva sua privacidade a sério, seguindo a <strong>Lei Geral de Proteção de Dados (LGPD)</strong>.
                        Abaixo, detalhamos as medidas de proteção (Técnicas e Administrativas) que implementamos:
                    </p>
                    
                    <div class="space-y-3 text-sm">
                        <!-- Criptografia -->
                        <div class="flex items-start">
                            <i class="fas fa-shield-alt text-green-600 w-5 text-center mr-3 mt-1"></i>
                            <div>
                                <strong class="text-gray-800">Criptografia e Comunicação Segura (SSL/TLS)</strong>
                                <p class="text-gray-600">Toda a comunicação entre seu navegador e nosso servidor (para o Ajudante AI, API do WhatsApp e Conversão de PDF) é 100% criptografada usando HTTPS (o "cadeado" no seu navegador).</p>
                            </div>
                        </div>
                        
                        <!-- Minimização e Anonimização -->
                        <div class="flex items-start">
                            <i class="fas fa-eye-slash text-gray-600 w-5 text-center mr-3 mt-1"></i>
                            <div>
                                <strong class="text-gray-800">Privacidade Total, Anonimização e Pseudonimização</strong>
                                <p class="text-gray-600">Seus contatos <strong>NUNCA</strong> saem do seu computador (Modo 1) ou são armazenados em nosso servidor (Modo 2). No Modo 2, os dados são repassados diretamente à API do WhatsApp e descartados. Para a IA e para a conversão de PDF, os dados são usados apenas para a operação e descartados imediatamente após, sem armazenamento.</p>
                            </div>
                        </div>

                        <!-- Proteção Anti-Hacking (XSS) -->
                        <div class="flex items-start">
                            <i class="fas fa-code text-red-600 w-5 text-center mr-3 mt-1"></i>
                            <div>
                                <strong class="text-gray-800">Proteção contra Hacking (XSS, Injection)</strong>
                                <p class="text-gray-600">O site "limpa" (higieniza) todas as entradas de texto (como nomes da sua planilha ou mensagens da IA) antes de exibi-las. Isso nos protege contra ataques do tipo Cross-Site Scripting (XSS). Nosso servidor (backend) também valida e higieniza todas as entradas para prevenir "Pseudo Hacking" ou ataques de injeção.</p>
                            </div>
                        </div>

                        <!-- Senhas e Eng. Social -->
                        <div class="flex items-start">
                            <i class="fas fa-key text-yellow-600 w-5 text-center mr-3 mt-1"></i>
                            <div>
                                <strong class="text-gray-800">Senhas, Autenticação e Proteção contra Engenharia Social</strong>
                                <p class="text-gray-600">Seu "Token de Acesso" (no Modo 2) é tratado como uma senha: ele é mascarado (***) e salvo *apenas temporariamente* na sessão do seu navegador. Nós *nunca* pediremos seu Token ou sua lista de contatos por e-mail ou chat.</p>
                            </div>
                        </div>

                        <!-- Controle de Acesso (IAM) -->
                        <div class="flex items-start">
                            <i class="fas fa-user-lock text-gray-600 w-5 text-center mr-3 mt-1"></i>
                            <div>
                                <strong class="text-gray-800">Controle de Acesso (IAM)</strong>
                                <p class="text-gray-600">Nosso servidor segue o Princípio do Acesso Mínimo. O acesso ao banco de dados e aos servidores de produção é restrito apenas a administradores autorizados.</p>

                            </div>
                        </div>

                        <!-- Firewall (WAF) -->
                        <div class="flex items-start">
                            <i class="fas fa-stream text-blue-600 w-5 text-center mr-3 mt-1"></i>
                            <div>
                                <strong class="text-gray-800">Proteção de Sistemas (Firewall - WAF)</strong>
                                <p class="text-gray-600">Nosso servidor é protegido por Firewalls de Aplicação Web (WAF) que monitoram e filtram ativamente o tráfego para bloquear atividades maliciosas antes que cheguem ao nosso código.</p>
                            </div>
                        </div>

                        <!-- Logs e Resposta a Incidentes -->
                        <div class="flex items-start">
                            <i class="fas fa-clipboard-list text-gray-600 w-5 text-center mr-3 mt-1"></i>
                            <div>
                                <strong class="text-gray-800">Monitoramento, Logs e Resposta a Incidentes</strong>
                                <p class="text-gray-600">Registramos (logamos) eventos de segurança (como "IP X tentou usar o chat"), mas NUNCA registramos o conteúdo das suas conversas ou os dados da sua planilha. Isso nos permite detectar e responder a incidentes sem comprometer sua privacidade.</p>

                            </div>
                        </div>

                        <!-- Backups -->
                        <div class="flex items-start">
                            <i class="fas fa-save text-gray-600 w-5 text-center mr-3 mt-1"></i>
                            <div>
                                <strong class="text-gray-800">Backups Regulares e Seguros</strong>
                                <p class="text-gray-600">Como não armazenamos seus dados, o risco de perda é mínimo. No entanto, fazemos backups regulares dos nossos próprios sistemas (logs de segurança e configuração do servidor) para garantir a continuidade do serviço.</p>
                            </div>
                        </div>

                        <!-- Governança (PSI) -->
                        <div class="flex items-start">
                            <i class="fas fa-book text-gray-600 w-5 text-center mr-3 mt-1"></i>
                            <div>
                                <strong class="text-gray-800">Governança e Política (PSI)</strong>
                                <p class="text-gray-600">Esta própria seção de ajuda serve como parte da nossa Política de Segurança da Informação (PSI), garantindo transparência total (Princípio da Transparência) sobre como protegemos você e seus dados.</p>
G                            </div>
                        </div>

                    </div>
                </div>
                <!-- FIM DA SEÇÃO ATUALIZADA -->

            </div>
        </div>
    </div>


    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="text-center text-sm text-gray-500">
                <!-- ATUALIZADO PARA 2025 -->
                <p>&copy; 2025 Disparador de Contatos. Construído com foco total em privacidade.</p>
            </div>
        </div>
    </footer>

    <!-- Script Principal do App -->
    <script src="main.js"></script>
</body>
</html>